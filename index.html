<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<style>
			#map {
				height: 100vh;
			}
		</style>
		<title>Document</title>
		<!-- Leaflet CSS-->
		<link
			rel="stylesheet"
			href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
		/>
	</head>
	<body>
		<div id="map"></div>
		<script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
		<script src="./DroneMap.js"></script>
		<script>
			let position1Config = null;
			let lastPosition1 = null;
			const droneMap = new DroneMap({
				defaultLocation: { lat: 21.0285, lng: 105.8542 },
				zoomLevel: 19,
				droneIcon: L.icon({
					iconUrl: 'asserts/drone-icon.png',
					iconSize: [50, 25],
					iconAnchor: [25, 25],
				}),
			});
			droneMap.initMap();

			const eraWidget = new EraWidget();
			eraWidget.init({
				needRealtimeConfigs: true,
				needHistoryConfigs: false,
				needActions: true,
				maxRealtimeConfigsCount: 1,
				maxHistoryConfigsCount: 1,
				maxActionsCount: 1,
				minRealtimeConfigsCount: 0,
				minHistoryConfigsCount: 0,
				minActionsCount: 0,
				onConfiguration: (configuration) => {
					position1Config = configuration.realtime_configs[0];
				},
				onValues: (values) => {
					const position1 = values[position1Config.id];
					console.log('position1', position1);
					if (position1) {
						let positionData1 = JSON.parse(position1.value);
						const { lat, lng } = positionData1;
						if (lat && lng && (!lastPosition1 || lastPosition1.lat !== lat || lastPosition1.lng !== lng)) {
							droneMap.updateDroneLocation(positionData1);
							lastPosition1 = positionData1;
						}
					}
				},
			});
		</script>
	</body>
</html>
